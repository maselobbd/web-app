<main class="nudge-container">
  <section *ngIf="groupedData.length > 0">
    <h1 class="header">Nudge students</h1>

    <section *ngFor="let data of groupedData">
      <mat-expansion-panel *ngIf="data.semesterOneTranscriptExists.length > 0">
        <mat-expansion-panel-header>
          <section class="year-container">
            <h2>{{ data.year }}: Mid-year results</h2>
            <p>
              {{ data.semesterOneTranscriptExists.length }} students outstanding
            </p>
            <button
              mat-flat-button
              color="primary"
              type="button"
              class="nudge-button"
              (click)="nudgeAllStudentsForSemester();
              $event.stopPropagation()"
            >
              Nudge students
            </button>
          </section>
        </mat-expansion-panel-header>

        <mat-divider class="divider"></mat-divider>

        <section class="table-container">
          <h3>Outstanding students</h3>
          <section>
            <table
              mat-table
              [dataSource]="data.semesterOneTranscriptExists"
              class="custom-table"
            >
              <ng-container matColumnDef="fullName">
                <th mat-header-cell *matHeaderCellDef class="bold-header">
                  Student Name
                </th>
                <td
                  mat-cell
                  *matCellDef="let element"
                  data-label="Student Name"
                >
                  {{ element.fullName }}
                </td>
              </ng-container>

              <ng-container matColumnDef="universityName">
                <th mat-header-cell *matHeaderCellDef class="bold-header">
                  University Name
                </th>
                <td
                  mat-cell
                  *matCellDef="let element"
                  data-label="University Name"
                >
                  {{ element.universityName }}
                </td>
              </ng-container>

              <ng-container matColumnDef="email">
                <th mat-header-cell *matHeaderCellDef class="bold-header">
                  Email
                </th>
                <td mat-cell *matCellDef="let element" data-label="Email">
                  {{ element.email }}
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
            </table>
          </section>
        </section>
      </mat-expansion-panel>
      <mat-divider class="divider"></mat-divider>
      <mat-expansion-panel *ngIf="data.semesterTwoTranscriptExists.length > 0">
        <mat-expansion-panel-header class="header-container">
          <section class="year-container">
            <h2>{{ data.year }}: Final-year results</h2>
            <p>
              {{ data.semesterTwoTranscriptExists.length }} students outstanding
            </p>
            <button
              mat-flat-button
              type="button"
              color="primary"
              class="nudge-button"
              (click)="nudgeAllStudentsForSemester();
              $event.stopPropagation()"
            >
              Nudge students
            </button>
          </section>
        </mat-expansion-panel-header>

        <mat-divider class="divider"></mat-divider>

        <section class="table-container">
          <h3>Outstanding students</h3>
          <section>
            <table
              mat-table
              [dataSource]="data.semesterTwoTranscriptExists"
              class="custom-table"
            >
              <ng-container matColumnDef="fullName">
                <th mat-header-cell *matHeaderCellDef class="bold-header">
                  Student Name
                </th>
                <td
                  mat-cell
                  *matCellDef="let element"
                  data-label="Student Name"
                >
                  {{ element.fullName }}
                </td>
              </ng-container>

              <ng-container matColumnDef="universityName">
                <th mat-header-cell *matHeaderCellDef class="bold-header">
                  University Name
                </th>
                <td
                  mat-cell
                  *matCellDef="let element"
                  data-label="University Name"
                >
                  {{ element.universityName }}
                </td>
              </ng-container>

              <ng-container matColumnDef="email">
                <th mat-header-cell *matHeaderCellDef class="bold-header">
                  Email
                </th>
                <td mat-cell *matCellDef="let element" data-label="Email">
                  {{ element.email }}
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
            </table>
          </section>
        </section>
      </mat-expansion-panel>
    </section>
  </section>
  <section class="error-text-container" *ngIf="students.length === 0 && !isLoading">
    <app-error-message
      [errorMessage]="noStudentsToNudgeMessage"
    ></app-error-message>
  </section>
  <app-loader></app-loader>
</main>
